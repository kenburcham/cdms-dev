<h3>Import dataset activity</h3>
<h5>Target: {{dataset.Name}}</h5>


<div class="alert alert-danger" ng-show="uploadErrorMessage">
<a class="close" ng-click="uploadErrorMessage=undefined">X</a>
<h4 class="alert-heading">Error!</h4>
{{uploadErrorMessage}}
</div>

<div ng-include="'partials/dataentry/messages.html'"/>

<div class="row" style="min-height: fill-available;" ng-show="!activities.success">

    <div class="panel" ng-show="!UploadResults.showPreview" style="margin: 20px 20px 45px 20px; background-color: #F5FBEF; padding: 4px 10px 45px 10px;">
        
        <div class="row">
            
            <div class="col-md-4" style="background-color: #CEE3F6; padding: 40px; height: 300px;border-radius:6px;">
                <h4 class="text-center">Step 1: Upload data file</h4>
                <br/>
                <input type="file" ng-file-select="onFileSelect($files)" value="{{file.name}}">
                <br/>
                <div class="right" style="margin-top: 3px; margin-left: 5px;"><img ng-show="loading" src="images/FishLoading.gif"/></div>
                <button class="btn btn-primary right" ng-disabled="!file" ng-click="uploadFile()">Load >></button>
                
            </div>
            
            <div class="col-md-4" style="min-height: 300px; ">
            <h4 class="text-center">Step 2: Map Columns</h4>
                <table class="table table-striped">
                <tr ng-repeat="file_name in fileFields">
                    <td>{{file_name}}</td>
                    <td>
                        <select class="form-control" style="width: 160px;" ng-change="updateSpecialFields(file_name)" ng-model="mapping[file_name]" ng-options="Value.Label for Value in mappableFields"/>
                    </td>
                </tr>
                </table>
                <p ng-show="!fileFields" style="text-align: center;"><i>Load a file to map columns.</i></p>
            </div>
            
            <div class="col-md-4 options-panel">
            <h4 class="text-center">Step 3: Options</h4>
                <table ng-show="fileFields">
                <tr>
                    <td>Location:</td><td> <select ng-show="!mappedActivityFields['2']" class="query-form-control form-control" ng-model="ActivityFields.LocationId"  ng-options="id as name for (id, name) in locationOptions">
                                
                            </select>
                            <div class="mapped-activity-field" ng-show="mappedActivityFields['2']">Use: {{mappedActivityFields['2']}}</div>
                    </td>
                </tr>
                <tr>
                    <td>Activity Date:</td><td><input type="text" datepicker-popup="shortDate" ng-model="ActivityFields.ActivityDate" is-open="copened" min="'2000-01-01'" max="'2015-06-22'" datepicker-options="dateOptions" ng-required="false" close-text="Close" ng-show="!mappedActivityFields['1']"/>
                    <div class="mapped-activity-field" ng-show="mappedActivityFields['1']">Use: {{mappedActivityFields['1']}}</div>
                    </td>
                </tr>
                <tr>
                    <td>QA Status:</td>
                    <td>
                    <select class="form-control" ng-model="ActivityFields.QAStatusId" ng-options="id as name for (id, name) in QAStatusOptions">
                    </select>
                    
                    </td>

                </tr>
                </table>
                <p ng-show="!fileFields" style="text-align: center; margin-top: 30px;"><i>Load a file to select options.</i></p>
            
            </div>
        </div>

        <div class="top-divider"></div>

        <div style="margin-top: 55px;">
            <button class="btn right" ng-disabled="!enablePreview" ng-click="previewUpload()" style="margin-left: 5px;">Preview >></button>
            <button class="btn btn-warning right" ng-click="cancel()">Cancel</button>

        </div>
    </div>

    <div class="panel" ng-show="UploadResults.showPreview" style="margin: 20px 20px 45px 20px; background-color: #F5FBEF; padding: 4px 10px 45px 10px;">
        <div class="well well-lg">
            <div class="error-table" style="width: 300px;">
                <h4>Import preview results:</h4>
                <table class="table table-striped table-bordered table-condensed">
                    <tbody>
                        <tr>
                            <td>Total Records:</td><td>{{dataSheetDataset.length + ValidRecordsBucket.length}}</td>
                        </tr>
                        <tr>
                            <td>Records with errors:</td><td>{{validation_error_count}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        <div style="height: 100px; width: 400px; float: right; margin-top: -150px;" ng-include="'partials/grid-validation-error-box.html'"></div>

        <div class="datasheet-grid" ng-grid="gridDatasheetOptions" style="margin-top: 20px;"></div>

        <div style="margin-top: 15px; padding-bottom: 30px;">
            <button class="btn" ng-disabled="!onRow" ng-click="removeRow()">Remove Row</button>
            <button ng-show="deletedRows.length" class="btn" ng-click="undoRemoveRow()">Undo</button>

            <div class="right" style="margin-top: 3px; margin-left: 5px;"><img ng-show="activities.saving" src="images/FishLoading.gif"/></div>
            <button class="btn right" ng-disabled="gridHasErrors || activities.saving" ng-click="saveDataSheet()" style="margin-left: 5px;">Import</button>
            <button class="btn btn-warning right" ng-click="cancel()">Cancel</button>
            <br/>
            <div ng-show="activities.saving" style="float: right;margin-right: 20px;" class="alert alert-success">Saving...
            </div>
        </div>



    </div>

</div>

