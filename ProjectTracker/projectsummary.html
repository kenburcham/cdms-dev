<!DOCTYPE html>
	<head>
		<meta charset="utf-8">
		<title>Project Summary</title>

		<script>
		    dojoConfig = {
		        async: true, //means you can't use any "dojo." stuff!
		        isDebug: true,
		        baseUrl: '.',
		        tlmSiblingOfDojo: false,
		        packages: [
                {
                    name: 'ctuir', location: location.pathname.replace(/\/[^/]+$/, '') + '/ctuir'
                },
                {
                    name: 'templates', location: location.pathname.replace(/\/[^/]+$/, '') + '/templates'
                }
		        ]
		    };
		</script>
		<!-- load dojo -->
		<script src="//ajax.googleapis.com/ajax/libs/dojo/1.9.1/dojo/dojo.js"></script>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:400,800,600' rel='stylesheet' type='text/css'>
        <script src="ctuir/Core.js"></script>

        <style>
             html, body{
                font-family: 'Open Sans', sans-serif;
                font-size: 12px;
                width: 1030px;
            }

            h1 { font-size: 18px; margin: 0px; font-weight: 800;}
            h2 { font-size: 16px; margin: 0px; font-weight: 400;}
            h3 { font-size: 15px; margin: 0px;font-weight: 400;}
            h4 { font-size: 14px; margin: 0px;font-weight: 400;}
            h5 { font-size: 13px; margin: 0px;font-weight: 600; padding-bottom: 2px;}
            p { margin-top: 0px; margin-bottom: 1px; padding-left: 5px;}
            
            .large-12 { width: 1000px; }
            .large-8 { width: 600px; }
            .large-2 { width: 200px; }
            .large-6 { width: 500px; }

            .columns { display: inline; float: left; padding-left: 5px; padding-right: 5px;}
            .panel { border: solid 1px gray; padding: 7px; background-color: lightgray; margin-top: 3px; margin-bottom: 3px;}
            table { 
                border: solid 3px gray; 
                background-color: lightgray; 
                margin-top: 3px; 
                margin-bottom: 25px; 
                border-collapse: collapse; 
            }
            td
            {
                border: solid 1px lightgray;
                border-style: inset;
                padding: 5px;
            }

            .td-header{ font-weight: bold; }

            #ctuir-footer
            {
                background-color: black;
                color: white;
                padding: 4px;
                margin-bottom: 10px;
                text-align: center;
                font-size: x-small;
            }

            #image-box { margin-left: 10px; }

            #image-box img {max-width: 100%;}

            .selected-image-div
            {
                float: left; max-width: 49%; min-width: 40%;  height: 210px;  padding: 3px;
            }

            .map-image-div
            {
                height: 135px;
            }

        </style>

		<script>

		    require([
				"ctuir/widget/ProjectSummaryWidget",
                "dojo/request/xhr",
                "dojo/dom",
                "dojo/dom-attr"
		    ], function (ProjectSummaryWidget, request, dom, domAttr) {
		        console.log("Starting up...");
		        try {
		            console.log("query = " + window.location.search);

		            var urlparams = window.location.search.split("=");

                    //console.dir(urlparams);

		            var projectid = urlparams[1];

		            console.log("and the projectid = " + projectid);

                    if(!projectid)
		            {
                        dom.byId("load-message").innerHTML = "Error: No project specified.";
		                return;
		            }
                
                    console.log("Loading project: " + projectid);

		            request("/services/api/projects/" + projectid, { handleAs: "json" }).then(function (project) {
                    
		                try{
		                    console.log("Project loaded: ");
		                    dom.byId("projectDetails").innerHTML = "";

		                    console.dir(project);

		                    flattenProject(project);
		                    //console.dir(project);

		                    console.log("loading displaywidget");
		                    var widget = new ProjectSummaryWidget(project).placeAt("projectDetails");
		                    widget.startup();

		                    domAttr.set("pdf-link", "href", "http://pdfmyurl.com?width=11in&height=8.5in&url=data.ctuir.org%2fjsdemo%2fprojectsummary.html%3fid%3d" + projectid);

		                    //document.getElementById("pdf-link").click();
		                } catch (e) {
		                    console.dir(e);
		                }
		                
                    
		            },
                    function (err) {
                        dom.byId("load-message").innerHTML = "Error: Project not found.";
                    });
		        } catch (e) {
		            console.dir(e);
		        }

		        

		    });

		    console.log("done.");

		</script>
 	</head>

	<body>
        <div id="projectDetails"><center><img src="images/flag.jpg" /><br /><h1><div id="load-message">Loading Project Information...</div></h1></center></div>
        
        <div class="row">
        <div class="large-12 columns">
            <center>
                <a id="pdf-link" href="#">All Rights Reserved.</a>
            </center>
        </div>
        </div>


</body>
</html>